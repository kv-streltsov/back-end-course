  > Homework 9  Devices  GET -> "/security/devices", DELETE -> "/security/devices/:deviceId", DELETE -> "security/devices": should return error if auth credentials is incorrect; status 401;



    Tested case params:
     endpoint: security/devices/0a5b5c3c-c1a9-43be-9c9f-ee3d7154ffba,
     method: DELETE,
     headers: undefined,

    Expected status: 401

    Received status: 404

      49 |       }
      50 |
    > 51 |       expect(status).toBeWith4xxStatus(expectedStatusCode, {
         |                      ^
      52 |         headers,
      53 |         endpoint,
      54 |         method,

      at performEndpointErrorChecker (src/tests/jest/back/testHelpers/performCheckers.ts:51:22)
          at runMicrotasks (<anonymous>)
      at Object.<anonymous> (src/tests/jest/back/describes/devices/devices-describe.ts:243:7)

  > Homework 9  Devices  DELETE -> "/security/devices/:sessionId":
      Get device list by user1.
      Create user2, login user 2 with the same user-agent header as user 1.
      Try to delete second device by user2 from device list of user1.
      Should return forbidden error
      ; status 403;  used additional methods: GET -> /security/devices, POST -> /users, POST -> /auth/login;



    Tested case params:
     endpoint: security/devices/0a5b5c3c-c1a9-43be-9c9f-ee3d7154ffba,
     method: DELETE,
     headers: {"cookie":"refreshToken=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiIyYzAyMjEwNC1jMThlLTRjMTMtYWM1NC1kYWY0NjgxYWZiNWUiLCJkZXZpY2VJZCI6ImU3NzY5ZmQyLWNmYmEtNDVmYy04NTA4LTk5OGU2ODI4Njk3YyIsImlhdCI6MTY4NjY3Njg1NSwiZXhwIjoxNjg2Njc2ODc1fQ.W7Nvn4BjksB6HtjEZcC5mhGyc6Eu6k5xqeC48nxOlZg;"},

    Expected status: 403

    Received status: 404

    Description: try to update or delete the entity that was created by another user

      49 |       }
      50 |
    > 51 |       expect(status).toBeWith4xxStatus(expectedStatusCode, {
         |                      ^
      52 |         headers,
      53 |         endpoint,
      54 |         method,

      at performEndpointErrorChecker (src/tests/jest/back/testHelpers/performCheckers.ts:51:22)
          at runMicrotasks (<anonymous>)
      at Object.<anonymous> (src/tests/jest/back/describes/devices/devices-describe.ts:301:7)

  > Homework 9  Devices  GET -> "/security/devices": should not change device id after call /auth/refresh-token. LastActiveDate should be changed; status 200; content: device list;

    expect(received).toHaveLength(expected)

    Expected length: 4
    Received length: 5
    Received array:  [{"deviceId": "c2abe669-c1e3-4253-b50b-ef2d11bede22", "ip": "3.69.49.83", "lastActiveDate": "2023-06-13T17:20:53.000Z", "title": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36"}, {"deviceId": "0a5b5c3c-c1a9-43be-9c9f-ee3d7154ffba", "ip": "3.69.49.83", "lastActiveDate": "2023-06-13T17:20:53.000Z", "title": "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:105.0) Gecko/20100101 Firefox/103.0"}, {"deviceId": "99391bf7-6f90-4e53-a147-aeb5afdf410b", "ip": "3.69.49.83", "lastActiveDate": "2023-06-13T17:20:53.000Z", "title": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36"}, {"deviceId": "496c8819-d19b-4df1-817d-725d833a0eca", "ip": "3.69.49.83", "lastActiveDate": "2023-06-13T17:20:54.000Z", "title": "Mozilla/5.0 (Macintosh; Intel Mac OS X 12_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.6 Safari/605.1.15"}, {"deviceId": "8ccc18a4-b343-428a-8209-85d531f9c9ce", "ip": "3.69.49.83", "lastActiveDate": "2023-06-13T17:20:57.000Z", "title": "axios/1.3.4"}]

      323 |
      324 |       expect(devicesList).toBeStrictObjectsArray(securityDeviceSchema);
    > 325 |       expect(devicesList).toHaveLength(LOGGED_DEVICES_COUNT);
          |                           ^
      326 |       expect(devicesList).toStrictEqual(
      327 |         expect.arrayContaining([
      328 |           expect.objectContaining({ deviceId: chrome105DeviceIdBeforeRefresh }),

      at Object.<anonymous> (src/tests/jest/back/describes/devices/devices-describe.ts:325:27)
          at runMicrotasks (<anonymous>)

  > Homework 9  Devices  DELETE -> "/security/devices/deviceId": should delete device from device list by deviceId; status 204;  used additional methods: GET => /security/devices;



    Expected: success response

    Received: Request failed with status code 404

    Config:
     url: security/devices/0a5b5c3c-c1a9-43be-9c9f-ee3d7154ffba
     method: delete
     response status: 404
     request body: undefined
     response data: "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<title>Error</title>\n</head>\n<body>\n<pre>Cannot DELETE /security/devices/0a5b5c3c-c1a9-43be-9c9f-ee3d7154ffba</pre>\n</body>\n</html>\n"

      22 |     };
      23 |
    > 24 |     expect(mappedError).printError(description);
         |                         ^
      25 |   }
      26 |
      27 |   throw new Error(error.message);

      at handleTestError (src/tests/jest/back/testHelpers/handleTestError.ts:24:25)
      at src/tests/jest/back/describes/devices/devices-describe.ts:363:41
          at runMicrotasks (<anonymous>)
      at Object.<anonymous> (src/tests/jest/back/describes/devices/devices-describe.ts:360:50)

  > Homework 9  Devices  DELETE -> "/security/devices": should delete all other devices from device list; status 204;  used additional methods: GET => /security/devices;



    Expected: success response

    Received: Request failed with status code 401

    Config:
     url: security/devices
     method: get
     response status: 401
     request body: undefined
     response data: "Unauthorized"

      22 |     };
      23 |
    > 24 |     expect(mappedError).printError(description);
         |                         ^
      25 |   }
      26 |
      27 |   throw new Error(error.message);

      at handleTestError (src/tests/jest/back/testHelpers/handleTestError.ts:24:25)
      at src/tests/jest/back/describes/devices/devices-describe.ts:442:35
          at runMicrotasks (<anonymous>)
      at Object.<anonymous> (src/tests/jest/back/describes/devices/devices-describe.ts:441:48)

  > Homework 9  Ip restriction  POST -> "/auth/registration": should return status code 429 if more than 5 requests were sent within 10 seconds, and 204 after waiting; status 429, 204;

    expect(received).toBe(expected) // Object.is equality

    Expected: 429
    Received: 204

      42 |         method: 'post',
      43 |       });
    > 44 |       expect(statusAfter5Attempts).toBe(429);
         |                                    ^
      45 |
      46 |       await delay(timeout);
      47 |       const statusAfter10secWaiting = await performRequest({

      at Object.<anonymous> (src/tests/jest/back/describes/ipRestriction/ipRestriction.ts:44:36)
          at runMicrotasks (<anonymous>)

  > Homework 9  Ip restriction  POST -> "/auth/login": for a non-existent user, it should return status code 429 if more than 5 requests were sent within 10 seconds, and 401 after waiting; status 429, 401;

    expect(received).toBe(expected) // Object.is equality

    Expected: 429
    Received: 401

      19 |
      20 |   const statusAfterSeveralAttempts = await performRequest({ method: 'post', endpoint, body });
    > 21 |   expect(statusAfterSeveralAttempts).toBe(429);
         |                                      ^
      22 |
      23 |   await delay(delayTime);
      24 |   const statusAfterWaiting = await performRequest({ method: 'post', endpoint, body });

      at performManyAttemptsTestFlow (src/tests/jest/back/describes/ipRestriction/performManyAttemptsTestFlow.ts:21:38)
          at runMicrotasks (<anonymous>)
      at Object.<anonymous> (src/tests/jest/back/describes/ipRestriction/ipRestriction.ts:71:7)

  > Homework 9  Ip restriction  POST -> "/auth/registration-email-resending": should return status code 429 if more than 5 requests were sent within 10 seconds, and 204 after waiting; status 429, 204;

    expect(received).toBe(expected) // Object.is equality

    Expected: 429
    Received: 204

      19 |
      20 |   const statusAfterSeveralAttempts = await performRequest({ method: 'post', endpoint, body });
    > 21 |   expect(statusAfterSeveralAttempts).toBe(429);
         |                                      ^
      22 |
      23 |   await delay(delayTime);
      24 |   const statusAfterWaiting = await performRequest({ method: 'post', endpoint, body });

      at performManyAttemptsTestFlow (src/tests/jest/back/describes/ipRestriction/performManyAttemptsTestFlow.ts:21:38)
          at runMicrotasks (<anonymous>)
      at Object.<anonymous> (src/tests/jest/back/describes/ipRestriction/ipRestriction.ts:92:7)

  > Homework 9  Ip restriction  POST -> "/auth/registration-confirmation": should return status code 429 if more than 5 requests were sent within 10 seconds, and 400 after waiting; status 429, 400;

    expect(received).toBe(expected) // Object.is equality

    Expected: 429
    Received: 400

      19 |
      20 |   const statusAfterSeveralAttempts = await performRequest({ method: 'post', endpoint, body });
    > 21 |   expect(statusAfterSeveralAttempts).toBe(429);
         |                                      ^
      22 |
      23 |   await delay(delayTime);
      24 |   const statusAfterWaiting = await performRequest({ method: 'post', endpoint, body });

      at performManyAttemptsTestFlow (src/tests/jest/back/describes/ipRestriction/performManyAttemptsTestFlow.ts:21:38)
          at runMicrotasks (<anonymous>)
      at Object.<anonymous> (src/tests/jest/back/describes/ipRestriction/ipRestriction.ts:112:7)
